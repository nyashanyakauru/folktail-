import{r,j as e}from"./react-Bg0AdYzf.js";import{c as xs}from"./react-dom-CxhMIu8E.js";import{V as xe,R as pe,A as he,C as ge,T as je,D as ve,P as ps,a as ye,b as hs,S as gs,c as Ne,d as be,e as we,f as js,g as Se,I as ke,h as Ce,i as Te,j as Re,L as _e,k as Ee,l as vs,m as ys,O as Pe,n as Fe,o as Ns,p as Ie,q as Me,r as bs,s as ws,t as Ss,u as De,v as ks,w as Cs,x as Ts,y as Ae,z as Rs,B as Oe,E as Le,F as _s,G as ze,H as Es,J as Ue,K as qe,M as Ps,N as Fs,Q as Be,U as Is,W as Ms}from"./@radix-ui-HivqB4RB.js";import{c as J}from"./class-variance-authority-Dp3B9jqt.js";import{c as Ds}from"./clsx-B-dksMZM.js";import{t as As}from"./tailwind-merge-Dnoi3Axr.js";import{X as Ve,C as Os,a as $e,b as Ls,M as zs,P as Us,c as qs,V as Bs,d as Vs,T as $s,S as Ws,e as Gs,B as A,H as K,L as Hs,U as Ys,f as We,g as Js,F as Ks,h as Qs,i as Ge,j as Zs,k as X,l as Xs,m as et,n as st,o as tt,p as at,A as de}from"./lucide-react-qwkRaheO.js";import{j as He,z as rt}from"./next-themes-C5Q0BOVC.js";import{T as ot}from"./sonner-BhcDigH6.js";import{Q as nt,a as it}from"./@tanstack-C7Td7v-W.js";import{L as I,B as lt}from"./react-router-dom-Clh3ohBr.js";import{c as ct}from"./@supabase-w8k7b2mS.js";import{a as dt,d as Ye,e as ut,b as mt,f as ft,g as q}from"./react-router-6511sdkk.js";import"./scheduler-CzFDRTuY.js";import"./aria-hidden-DQ5UC2Eg.js";import"./react-remove-scroll-B8-EcrUg.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-lhJi2-h0.js";import"./react-style-singleton-BPNcg-2O.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-DxxblDFu.js";import"./use-callback-ref-CRXcfMq2.js";import"./@floating-ui-D79HHNiH.js";import"./@remix-run-Br25Cn4W.js";import"./isows-nSfPKTFW.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function a(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(n){if(n.ep)return;n.ep=!0;const l=a(n);fetch(n.href,l)}})();const xt=1,pt=1e6;let Q=0;function ht(){return Q=(Q+1)%Number.MAX_SAFE_INTEGER,Q.toString()}const Z=new Map,ue=s=>{if(Z.has(s))return;const t=setTimeout(()=>{Z.delete(s),V({type:"REMOVE_TOAST",toastId:s})},pt);Z.set(s,t)},gt=(s,t)=>{switch(t.type){case"ADD_TOAST":return{...s,toasts:[t.toast,...s.toasts].slice(0,xt)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(a=>a.id===t.toast.id?{...a,...t.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=t;return a?ue(a):s.toasts.forEach(o=>{ue(o.id)}),{...s,toasts:s.toasts.map(o=>o.id===a||a===void 0?{...o,open:!1}:o)}}case"REMOVE_TOAST":return t.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(a=>a.id!==t.toastId)}}},G=[];let H={toasts:[]};function V(s){H=gt(H,s),G.forEach(t=>{t(H)})}function jt({...s}){const t=ht(),a=n=>V({type:"UPDATE_TOAST",toast:{...n,id:t}}),o=()=>V({type:"DISMISS_TOAST",toastId:t});return V({type:"ADD_TOAST",toast:{...s,id:t,open:!0,onOpenChange:n=>{n||o()}}}),{id:t,dismiss:o,update:a}}function U(){const[s,t]=r.useState(H);return r.useEffect(()=>(G.push(t),()=>{const a=G.indexOf(t);a>-1&&G.splice(a,1)}),[s]),{...s,toast:jt,dismiss:a=>V({type:"DISMISS_TOAST",toastId:a})}}function f(...s){return As(Ds(s))}const vt=ps,Je=r.forwardRef(({className:s,...t},a)=>e.jsx(xe,{ref:a,className:f("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...t}));Je.displayName=xe.displayName;const yt=J("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Ke=r.forwardRef(({className:s,variant:t,...a},o)=>e.jsx(pe,{ref:o,className:f(yt({variant:t}),s),...a}));Ke.displayName=pe.displayName;const Nt=r.forwardRef(({className:s,...t},a)=>e.jsx(he,{ref:a,className:f("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",s),...t}));Nt.displayName=he.displayName;const Qe=r.forwardRef(({className:s,...t},a)=>e.jsx(ge,{ref:a,className:f("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...t,children:e.jsx(Ve,{className:"h-4 w-4"})}));Qe.displayName=ge.displayName;const Ze=r.forwardRef(({className:s,...t},a)=>e.jsx(je,{ref:a,className:f("text-sm font-semibold",s),...t}));Ze.displayName=je.displayName;const Xe=r.forwardRef(({className:s,...t},a)=>e.jsx(ve,{ref:a,className:f("text-sm opacity-90",s),...t}));Xe.displayName=ve.displayName;function bt(){const{toasts:s}=U();return e.jsxs(vt,{children:[s.map(function({id:t,title:a,description:o,action:n,...l}){return e.jsxs(Ke,{...l,children:[e.jsxs("div",{className:"grid gap-1",children:[a&&e.jsx(Ze,{children:a}),o&&e.jsx(Xe,{children:o})]}),n,e.jsx(Qe,{})]},t)}),e.jsx(Je,{})]})}const wt=({...s})=>{const{theme:t="system"}=He();return e.jsx(ot,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...s})},St=hs,kt=r.forwardRef(({className:s,sideOffset:t=4,...a},o)=>e.jsx(ye,{ref:o,sideOffset:t,className:f("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a}));kt.displayName=ye.displayName;const Ct="https://txjfuijuwdmhptxdudcb.supabase.co",Tt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR4amZ1aWp1d2RtaHB0eGR1ZGNiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQyOTUxMjcsImV4cCI6MjA2OTg3MTEyN30.aG5pcLhG0OfItKa5kS0Cx8RV-eNbTihWyO_RMLyB628",j=ct(Ct,Tt,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}}),es=r.createContext(void 0),C=()=>{const s=r.useContext(es);if(!s)throw new Error("useAuth must be used within an AuthProvider");return s},Rt=({children:s})=>{const[t,a]=r.useState(null),[o,n]=r.useState(null),[l,d]=r.useState(!0);r.useEffect(()=>{j.auth.getSession().then(({data:{session:g}})=>{n(g),a((g==null?void 0:g.user)??null),d(!1)});const{data:{subscription:u}}=j.auth.onAuthStateChange((g,i)=>{n(i),a((i==null?void 0:i.user)??null),d(!1)});return()=>u.unsubscribe()},[]);const w={user:t,session:o,loading:l,signIn:async(u,g)=>{const{data:i,error:c}=await j.auth.signInWithPassword({email:u,password:g});return{data:i,error:c}},signUp:async(u,g,i)=>{const{data:c,error:v}=await j.auth.signUp({email:u,password:g,options:{data:{full_name:i}}});return{data:c,error:v}},signOut:async()=>{await j.auth.signOut()}};return e.jsx(es.Provider,{value:w,children:s})},ss=r.createContext(void 0),_t=()=>{const s=r.useContext(ss);if(!s)throw new Error("useMusicContext must be used within a MusicProvider");return s},Et=({children:s})=>{const[t,a]=r.useState(!1),[o,n]=r.useState(null),[l,d]=r.useState([.5]),[x,p]=r.useState([]),[h,w]=r.useState(!1),u=r.useRef(null),{user:g}=C(),{toast:i}=U();r.useEffect(()=>(u.current||(u.current=new Audio,u.current.loop=!0,u.current.volume=l[0],u.current.onended=()=>a(!1),u.current.onerror=()=>{console.error("Audio failed to load"),i({title:"Playback Error",description:"Failed to load audio file",variant:"destructive"})}),()=>{u.current&&u.current.pause()}),[i]),r.useEffect(()=>{u.current&&(u.current.volume=l[0])},[l]),r.useEffect(()=>{g?c():(p([]),n(null),a(!1),u.current&&(u.current.pause(),u.current.src=""))},[g]);const c=async()=>{if(g)try{const{data:y,error:S}=await j.from("user_music").select("*").order("created_at",{ascending:!1});if(S)throw S;p(y||[])}catch(y){console.error("Error loading music:",y)}},F={isPlaying:t,currentTrack:o,volume:l,userTracks:x,loading:h,handlePlay:async()=>{if(!(!o||!u.current))try{t?(u.current.pause(),a(!1)):(await u.current.play(),a(!0))}catch(y){console.error("Audio playback failed:",y),i({title:"Playback Error",description:"Failed to play audio file",variant:"destructive"})}},handleTrackSelect:async y=>{if(u.current)try{const{data:S}=j.storage.from("music").getPublicUrl(y.file_path),D={...y,url:S.publicUrl};n(D),a(!1),u.current.pause(),u.current.currentTime=0,u.current.src=S.publicUrl}catch(S){console.error("Error selecting track:",S),i({title:"Error",description:"Failed to load music file",variant:"destructive"})}},setVolume:y=>{d(y)},loadUserMusic:c,uploadMusic:async y=>{if(g){if(!y.type.startsWith("audio/")){i({title:"Invalid File",description:"Please select an audio file",variant:"destructive"});return}if(y.size>52428800){i({title:"File Too Large",description:"Please select a file smaller than 50MB",variant:"destructive"});return}w(!0);try{const S=`${Date.now()}-${y.name.replace(/[^a-zA-Z0-9.-]/g,"_")}`,D=`${g.id}/${S}`,{error:ne}=await j.storage.from("music").upload(D,y);if(ne)throw ne;const W=new Audio;W.src=URL.createObjectURL(y);let ie=0;try{await new Promise((ce,fs)=>{W.onloadedmetadata=()=>{ie=Math.floor(W.duration),ce(null)},W.onerror=fs})}catch{console.log("Could not get audio duration")}const{error:le}=await j.from("user_music").insert({user_id:g.id,title:y.name.replace(/\.[^/.]+$/,""),file_path:D,file_size:y.size,duration:ie||null});if(le)throw le;i({title:"Upload Successful",description:"Your music file has been uploaded"}),await c()}catch(S){console.error("Upload error:",S),i({title:"Upload Failed",description:"Failed to upload music file",variant:"destructive"})}finally{w(!1)}}},deleteTrack:async y=>{if(!(!g||y.user_id!==g.id))try{const{error:S}=await j.storage.from("music").remove([y.file_path]);if(S)throw S;const{error:D}=await j.from("user_music").delete().eq("id",y.id);if(D)throw D;(o==null?void 0:o.id)===y.id&&(n(null),a(!1),u.current&&(u.current.pause(),u.current.src="")),await c(),i({title:"Deleted",description:"Music file deleted successfully"})}catch(S){console.error("Delete error:",S),i({title:"Delete Failed",description:"Failed to delete music file",variant:"destructive"})}}};return e.jsx(ss.Provider,{value:F,children:s})},Pt=J("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),b=r.forwardRef(({className:s,variant:t,size:a,asChild:o=!1,...n},l)=>{const d=o?gs:"button";return e.jsx(d,{className:f(Pt({variant:t,size:a,className:s})),ref:l,...n})});b.displayName="Button";const z=r.forwardRef(({className:s,type:t,...a},o)=>e.jsx("input",{type:t,className:f("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:o,...a}));z.displayName="Input";const Ft=J("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),M=r.forwardRef(({className:s,...t},a)=>e.jsx(Ne,{ref:a,className:f(Ft(),s),...t}));M.displayName=Ne.displayName;const ts=vs,as=ys,It=r.forwardRef(({className:s,inset:t,children:a,...o},n)=>e.jsxs(be,{ref:n,className:f("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",s),...o,children:[a,e.jsx(Os,{className:"ml-auto h-4 w-4"})]}));It.displayName=be.displayName;const Mt=r.forwardRef(({className:s,...t},a)=>e.jsx(we,{ref:a,className:f("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...t}));Mt.displayName=we.displayName;const re=r.forwardRef(({className:s,sideOffset:t=4,...a},o)=>e.jsx(js,{children:e.jsx(Se,{ref:o,sideOffset:t,className:f("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a})}));re.displayName=Se.displayName;const $=r.forwardRef(({className:s,inset:t,...a},o)=>e.jsx(ke,{ref:o,className:f("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",s),...a}));$.displayName=ke.displayName;const Dt=r.forwardRef(({className:s,children:t,checked:a,...o},n)=>e.jsxs(Ce,{ref:n,className:f("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:a,...o,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Te,{children:e.jsx($e,{className:"h-4 w-4"})})}),t]}));Dt.displayName=Ce.displayName;const At=r.forwardRef(({className:s,children:t,...a},o)=>e.jsxs(Re,{ref:o,className:f("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Te,{children:e.jsx(Ls,{className:"h-2 w-2 fill-current"})})}),t]}));At.displayName=Re.displayName;const ee=r.forwardRef(({className:s,inset:t,...a},o)=>e.jsx(_e,{ref:o,className:f("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",s),...a}));ee.displayName=_e.displayName;const Y=r.forwardRef(({className:s,...t},a)=>e.jsx(Ee,{ref:a,className:f("-mx-1 my-1 h-px bg-muted",s),...t}));Y.displayName=Ee.displayName;const Ot=ws,Lt=Ss,zt=bs,rs=r.forwardRef(({className:s,...t},a)=>e.jsx(Pe,{ref:a,className:f("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t}));rs.displayName=Pe.displayName;const os=r.forwardRef(({className:s,children:t,...a},o)=>e.jsxs(zt,{children:[e.jsx(rs,{}),e.jsxs(Fe,{ref:o,className:f("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...a,children:[t,e.jsxs(Ns,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Ve,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));os.displayName=Fe.displayName;const ns=({className:s,...t})=>e.jsx("div",{className:f("flex flex-col space-y-1.5 text-center sm:text-left",s),...t});ns.displayName="DialogHeader";const is=r.forwardRef(({className:s,...t},a)=>e.jsx(Ie,{ref:a,className:f("text-lg font-semibold leading-none tracking-tight",s),...t}));is.displayName=Ie.displayName;const Ut=r.forwardRef(({className:s,...t},a)=>e.jsx(Me,{ref:a,className:f("text-sm text-muted-foreground",s),...t}));Ut.displayName=Me.displayName;const ls=r.forwardRef(({className:s,...t},a)=>e.jsxs(De,{ref:a,className:f("relative flex w-full touch-none select-none items-center",s),...t,children:[e.jsx(ks,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(Cs,{className:"absolute h-full bg-primary"})}),e.jsx(Ts,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));ls.displayName=De.displayName;const qt=()=>{const[s,t]=r.useState(!1),[a,o]=r.useState(!1),n=r.useRef(null),{user:l}=C(),{isPlaying:d,currentTrack:x,volume:p,userTracks:h,loading:w,handlePlay:u,handleTrackSelect:g,setVolume:i,uploadMusic:c,deleteTrack:v}=_t(),k=async N=>{var y;const F=(y=N.target.files)==null?void 0:y[0];!F||!l||(await c(F),o(!1),n.current&&(n.current.value=""))},m=async(N,F)=>{F.stopPropagation(),await v(N)},T=async N=>{await g(N),t(!1)};return e.jsxs(ts,{open:s,onOpenChange:t,children:[e.jsx(as,{asChild:!0,children:e.jsxs(b,{variant:"ghost",size:"sm",className:"flex items-center space-x-2",children:[e.jsx(zs,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Music"})]})}),e.jsxs(re,{align:"end",className:"w-80",children:[e.jsx(ee,{children:"Reading Music"}),e.jsx(Y,{}),x&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-2 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:x.title}),x.artist&&e.jsx("p",{className:"text-xs text-muted-foreground",children:x.artist})]}),e.jsx(b,{variant:"ghost",size:"sm",onClick:u,className:"ml-2 h-8 w-8 p-0",children:d?e.jsx(Us,{className:"h-4 w-4"}):e.jsx(qs,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Bs,{className:"h-3 w-3 text-muted-foreground"}),e.jsx(ls,{value:p,onValueChange:i,max:1,step:.1,className:"flex-1"})]})]}),e.jsx(Y,{})]}),e.jsx("div",{className:"px-2 py-1",children:e.jsxs(Ot,{open:a,onOpenChange:o,children:[e.jsx(Lt,{asChild:!0,children:e.jsxs(b,{variant:"outline",size:"sm",className:"w-full",children:[e.jsx(Vs,{className:"h-4 w-4 mr-2"}),"Upload Music"]})}),e.jsxs(os,{children:[e.jsx(ns,{children:e.jsx(is,{children:"Upload Music File"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"music-file",children:"Select Audio File"}),e.jsx(z,{id:"music-file",type:"file",accept:"audio/*",ref:n,onChange:k,disabled:w}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Supported formats: MP3, WAV, OGG, M4A (Max 50MB)"})]}),w&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Uploading..."})]})]})]})}),e.jsx(Y,{}),e.jsx(ee,{children:"Your Music"}),h.length===0?e.jsx("div",{className:"px-2 py-4 text-center text-sm text-muted-foreground",children:"No music uploaded yet"}):h.map(N=>e.jsx($,{onClick:()=>T(N),className:`cursor-pointer ${(x==null?void 0:x.id)===N.id?"bg-accent":""}`,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex flex-col flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-medium truncate",children:N.title}),N.artist&&e.jsx("span",{className:"text-xs text-muted-foreground",children:N.artist})]}),(l==null?void 0:l.id)===N.user_id&&e.jsx(b,{variant:"ghost",size:"sm",onClick:F=>m(N,F),className:"h-6 w-6 p-0 ml-2 hover:bg-destructive hover:text-destructive-foreground",children:e.jsx($s,{className:"h-3 w-3"})})]})},N.id))]})]})};function Bt(){const{setTheme:s}=He();return e.jsxs(ts,{children:[e.jsx(as,{asChild:!0,children:e.jsxs(b,{variant:"outline",size:"icon",children:[e.jsx(Ws,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),e.jsx(Gs,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),e.jsx("span",{className:"sr-only",children:"Toggle theme"})]})}),e.jsxs(re,{align:"end",children:[e.jsx($,{onClick:()=>s("light"),children:"Light"}),e.jsx($,{onClick:()=>s("dark"),children:"Dark"}),e.jsx($,{onClick:()=>s("system"),children:"System"})]})]})}const L=()=>{const{user:s,signOut:t}=C(),a=dt(),o=async()=>{await t(),a("/")};return e.jsx("header",{className:"sticky top-0 z-50 w-full border-b border-border/40 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:e.jsxs("div",{className:"container flex h-16 items-center justify-between",children:[e.jsxs(I,{to:"/",className:"flex items-center space-x-2",children:[e.jsx(A,{className:"h-6 w-6 text-primary"}),e.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-primary to-magical bg-clip-text text-transparent",children:"FolkTales"})]}),e.jsxs("nav",{className:"flex items-center space-x-4",children:[e.jsx(Bt,{}),s?e.jsxs(e.Fragment,{children:[e.jsx(qt,{}),e.jsx(I,{to:"/favorites",children:e.jsxs(b,{variant:"ghost",size:"sm",className:"flex items-center space-x-2",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{children:"Favorites"})]})}),e.jsxs(b,{variant:"ghost",size:"sm",onClick:o,className:"flex items-center space-x-2",children:[e.jsx(Hs,{className:"h-4 w-4"}),e.jsx("span",{children:"Sign Out"})]}),e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-2 rounded-lg bg-muted",children:[e.jsx(Ys,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.email})]})]}):e.jsx(I,{to:"/auth",children:e.jsx(b,{variant:"default",size:"sm",children:"Sign In"})})]})]})})},me=Is,fe=Ms,se=r.forwardRef(({className:s,children:t,...a},o)=>e.jsxs(Ae,{ref:o,className:f("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...a,children:[t,e.jsx(Rs,{asChild:!0,children:e.jsx(We,{className:"h-4 w-4 opacity-50"})})]}));se.displayName=Ae.displayName;const cs=r.forwardRef(({className:s,...t},a)=>e.jsx(Oe,{ref:a,className:f("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(Js,{className:"h-4 w-4"})}));cs.displayName=Oe.displayName;const ds=r.forwardRef(({className:s,...t},a)=>e.jsx(Le,{ref:a,className:f("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(We,{className:"h-4 w-4"})}));ds.displayName=Le.displayName;const te=r.forwardRef(({className:s,children:t,position:a="popper",...o},n)=>e.jsx(_s,{children:e.jsxs(ze,{ref:n,className:f("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:a,...o,children:[e.jsx(cs,{}),e.jsx(Es,{className:f("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),e.jsx(ds,{})]})}));te.displayName=ze.displayName;const Vt=r.forwardRef(({className:s,...t},a)=>e.jsx(Ue,{ref:a,className:f("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...t}));Vt.displayName=Ue.displayName;const B=r.forwardRef(({className:s,children:t,...a},o)=>e.jsxs(qe,{ref:o,className:f("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ps,{children:e.jsx($e,{className:"h-4 w-4"})})}),e.jsx(Fs,{children:t})]}));B.displayName=qe.displayName;const $t=r.forwardRef(({className:s,...t},a)=>e.jsx(Be,{ref:a,className:f("-mx-1 my-1 h-px bg-muted",s),...t}));$t.displayName=Be.displayName;const Wt=({searchTerm:s,onSearchChange:t,region:a,onRegionChange:o,source:n,onSourceChange:l})=>{const[d,x]=r.useState([]),[p,h]=r.useState([]);r.useEffect(()=>{w(),u()},[]);const w=async()=>{try{const{data:i,error:c}=await j.from("folktales").select("nation").not("nation","is",null).order("nation");if(c)throw c;const v=[...new Set(i==null?void 0:i.map(k=>k.nation).filter(Boolean))];x(v)}catch(i){console.error("Error fetching regions:",i)}},u=async()=>{try{const{data:i,error:c}=await j.from("folktales").select("source").not("source","is",null).order("source");if(c)throw c;const v=[...new Set(i==null?void 0:i.map(k=>k.source).filter(Boolean))];h(v)}catch(i){console.error("Error fetching sources:",i)}},g=i=>{i.key==="Enter"&&i.preventDefault()};return e.jsxs("div",{className:"space-y-4 p-6 bg-card rounded-lg border border-border/50",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(Ks,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Discover Stories"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"search",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(Qs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(z,{id:"search",placeholder:"Search by title, content, or theme... (Press Enter to search)",value:s,onChange:i=>t(i.target.value),onKeyPress:g,className:"pl-10"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"region",children:"Region"}),e.jsxs(me,{value:a,onValueChange:o,children:[e.jsx(se,{children:e.jsx(fe,{placeholder:"All regions"})}),e.jsxs(te,{children:[e.jsx(B,{value:"all",children:"All regions"}),d.map(i=>e.jsx(B,{value:i,children:i},i))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"source",children:"Source"}),e.jsxs(me,{value:n,onValueChange:l,children:[e.jsx(se,{children:e.jsx(fe,{placeholder:"All sources"})}),e.jsxs(te,{children:[e.jsx(B,{value:"all",children:"All sources"}),p.map(i=>e.jsx(B,{value:i,children:i},i))]})]})]})]})]})]})},R=r.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:f("rounded-lg border bg-card text-card-foreground shadow-sm",s),...t}));R.displayName="Card";const _=r.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:f("flex flex-col space-y-1.5 p-6",s),...t}));_.displayName="CardHeader";const E=r.forwardRef(({className:s,...t},a)=>e.jsx("h3",{ref:a,className:f("text-2xl font-semibold leading-none tracking-tight",s),...t}));E.displayName="CardTitle";const oe=r.forwardRef(({className:s,...t},a)=>e.jsx("p",{ref:a,className:f("text-sm text-muted-foreground",s),...t}));oe.displayName="CardDescription";const P=r.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:f("p-6 pt-0",s),...t}));P.displayName="CardContent";const us=r.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:f("flex items-center p-6 pt-0",s),...t}));us.displayName="CardFooter";const Gt=J("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function O({className:s,variant:t,...a}){return e.jsx("div",{className:f(Gt({variant:t}),s),...a})}const ms=({folktale:s,isFavorited:t=!1,onFavoriteChange:a})=>{const{user:o}=C(),{toast:n}=U(),[l,d]=r.useState(!1),x=async p=>{if(p.preventDefault(),p.stopPropagation(),!o){n({title:"Sign in required",description:"Please sign in to add favorites.",variant:"destructive"});return}d(!0);try{if(t){const{error:h}=await j.from("favorites").delete().eq("user_id",o.id).eq("folktale_id",s.id);if(h)throw h;n({title:"Removed from favorites",description:"Story removed from your favorites."})}else{const{error:h}=await j.from("favorites").insert({user_id:o.id,folktale_id:s.id});if(h)throw h;n({title:"Added to favorites",description:"Story added to your favorites."})}a==null||a()}catch(h){n({title:"Error",description:h.message,variant:"destructive"})}finally{d(!1)}};return e.jsx(R,{className:"group hover:shadow-lg transition-all duration-300 cursor-pointer overflow-hidden border-border/50 hover:border-primary/50",children:e.jsxs(I,{to:`/story/${s.id}`,children:[e.jsx(_,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(E,{className:"text-lg line-clamp-2 group-hover:text-primary transition-colors",children:s.title}),e.jsxs(oe,{className:"mt-2 flex items-center space-x-4 text-sm",children:[s.nation&&e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(Ge,{className:"h-3 w-3"}),e.jsx(O,{variant:"outline",className:"text-xs",children:s.nation})]}),s.source&&e.jsx(O,{variant:"secondary",className:"text-xs",children:s.source})]})]}),e.jsx(b,{variant:"ghost",size:"sm",className:"ml-2 p-2 h-8 w-8",onClick:x,disabled:l,children:e.jsx(K,{className:`h-4 w-4 transition-colors ${t?"fill-red-500 text-red-500":"text-muted-foreground hover:text-red-500"}`})})]})}),e.jsx(P,{children:e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-3",children:s.text.substring(0,100)+"..."})}),e.jsx(us,{className:"pt-0",children:e.jsxs(b,{variant:"ghost",size:"sm",className:"w-full group-hover:bg-primary/10",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Read Story"]})})]})})},Ht=()=>{const{user:s}=C(),[t,a]=r.useState({totalStories:0,completedStories:0,completionRate:0,recentlyCompleted:[]}),[o,n]=r.useState(!0);r.useEffect(()=>{s&&l()},[s]);const l=async()=>{if(s)try{const{count:d}=await j.from("folktales").select("*",{count:"exact",head:!0}),{count:x}=await j.from("reading_progress").select("*",{count:"exact",head:!0}).eq("user_id",s.id).eq("completed",!0),{data:p}=await j.from("reading_progress").select(`
          completed_at,
          folktales (
            id,
            title,
            nation
          )
        `).eq("user_id",s.id).eq("completed",!0).order("completed_at",{ascending:!1}).limit(5),h=d?Math.round((x||0)/d*100):0;a({totalStories:d||0,completedStories:x||0,completionRate:h,recentlyCompleted:p||[]})}catch(d){console.error("Error fetching progress stats:",d)}finally{n(!1)}};return s?o?e.jsxs(R,{children:[e.jsx(_,{children:e.jsx(E,{children:"Reading Progress"})}),e.jsx(P,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-muted rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-muted rounded w-2/3"})]})})]}):e.jsxs(R,{children:[e.jsx(_,{children:e.jsxs(E,{className:"flex items-center space-x-2",children:[e.jsx(Zs,{className:"h-5 w-5"}),e.jsx("span",{children:"Reading Progress"})]})}),e.jsxs(P,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(A,{className:"h-8 w-8 text-primary"})}),e.jsx("div",{className:"text-2xl font-bold",children:t.totalStories}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Stories"})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(X,{className:"h-8 w-8 text-green-600"})}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:t.completedStories}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Completed"})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Xs,{className:"h-8 w-8 text-blue-600"})}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[t.completionRate,"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Completion Rate"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[t.completedStories," / ",t.totalStories]})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${t.completionRate}%`}})})]}),t.recentlyCompleted.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Recently Completed"}),e.jsx("div",{className:"space-y-2",children:t.recentlyCompleted.map((d,x)=>{var p,h;return e.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted/50 rounded",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:(p=d.folktales)==null?void 0:p.title}),((h=d.folktales)==null?void 0:h.nation)&&e.jsx(O,{variant:"outline",className:"text-xs mt-1",children:d.folktales.nation})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(d.completed_at).toLocaleDateString()})]},x)})})]})]})]}):null},Yt=()=>{const{user:s}=C(),[t,a]=r.useState([]),[o,n]=r.useState(new Set),[l,d]=r.useState(!0),[x,p]=r.useState(""),[h,w]=r.useState("all"),[u,g]=r.useState("all");r.useEffect(()=>{i(),s&&c()},[s,x,h,u]);const i=async()=>{d(!0);try{let m=j.from("folktales").select("*");x.trim()&&(m=m.ilike("title",`%${x}%`)),h!=="all"&&(m=m.eq("nation",h)),u!=="all"&&(m=m.eq("source",u));const{data:T,error:N}=await m;if(N)throw N;a(T||[])}catch(m){console.error("Error fetching folktales:",m)}finally{d(!1)}},c=async()=>{if(s)try{const{data:m,error:T}=await j.from("favorites").select("folktale_id").eq("user_id",s.id);if(T)throw T;n(new Set((m==null?void 0:m.map(N=>N.folktale_id))||[]))}catch(m){console.error("Error fetching favorites:",m)}},v=()=>{c()},k=t;return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(L,{}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-3 mb-4",children:[e.jsx(A,{className:"h-10 w-10 text-primary"}),e.jsx("h1",{className:"text-5xl font-bold bg-gradient-to-r from-primary to-magical bg-clip-text text-transparent",children:"FolkTales"}),e.jsx(et,{className:"h-8 w-8 text-magical"})]}),e.jsx("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto",children:"Discover timeless stories from around the world. Each tale carries wisdom, wonder, and the power to inspire across generations."})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsx(Wt,{searchTerm:x,onSearchChange:p,region:h,onRegionChange:w,source:u,onSourceChange:g}),s&&e.jsx(Ht,{})]}),e.jsx("div",{className:"lg:col-span-3",children:l?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):k.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(A,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-muted-foreground mb-2",children:"No stories found"}),e.jsx("p",{className:"text-muted-foreground",children:"Try adjusting your search criteria to discover more tales."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs("h2",{className:"text-2xl font-semibold",children:[k.length," ",k.length===1?"Story":"Stories"," Found"]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:k.map(m=>e.jsx(ms,{folktale:m,isFavorited:o.has(m.id),onFavoriteChange:v},m.id))})]})})]})]})]})},Jt=({mode:s,onModeChange:t})=>{const[a,o]=r.useState(""),[n,l]=r.useState(""),[d,x]=r.useState(""),[p,h]=r.useState(!1),{signIn:w,signUp:u}=C(),{toast:g}=U(),i=async c=>{c.preventDefault(),h(!0);try{if(s==="signin"){const{error:v}=await w(a,n);if(v)throw v;g({title:"Welcome back!",description:"You've been signed in successfully."})}else{const{error:v}=await u(a,n,d);if(v)throw v;g({title:"Account created!",description:"Please check your email to verify your account."})}}catch(v){g({title:"Error",description:v.message,variant:"destructive"})}finally{h(!1)}};return e.jsxs(R,{className:"w-full max-w-md mx-auto",children:[e.jsxs(_,{className:"text-center",children:[e.jsx(E,{className:"text-2xl bg-gradient-to-r from-primary to-magical bg-clip-text text-transparent",children:s==="signin"?"Welcome Back":"Join Our World"}),e.jsx(oe,{children:s==="signin"?"Sign in to continue your folktale journey":"Create an account to discover amazing folktales"})]}),e.jsxs(P,{children:[e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[s==="signup"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"fullName",children:"Full Name"}),e.jsx(z,{id:"fullName",type:"text",placeholder:"Enter your full name",value:d,onChange:c=>x(c.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"email",children:"Email"}),e.jsx(z,{id:"email",type:"email",placeholder:"Enter your email",value:a,onChange:c=>o(c.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"password",children:"Password"}),e.jsx(z,{id:"password",type:"password",placeholder:"Enter your password",value:n,onChange:c=>l(c.target.value),required:!0})]}),e.jsx(b,{type:"submit",className:"w-full bg-gradient-to-r from-primary to-magical hover:opacity-90",disabled:p,children:p?s==="signin"?"Signing in...":"Creating account...":s==="signin"?"Sign In":"Sign Up"})]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{type:"button",onClick:()=>t(s==="signin"?"signup":"signin"),className:"text-sm text-muted-foreground hover:text-foreground transition-colors",children:s==="signin"?"Don't have an account? Sign up":"Already have an account? Sign in"})})]})]})},Kt=()=>{const[s,t]=r.useState("signin"),{user:a,loading:o}=C();return o?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):a?e.jsx(Ye,{to:"/",replace:!0}):e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-background to-muted/20",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsx(Jt,{mode:s,onModeChange:t})})})},Qt=()=>{const{user:s,loading:t}=C(),[a,o]=r.useState([]),[n,l]=r.useState(!0);r.useEffect(()=>{s&&d()},[s]);const d=async()=>{if(s)try{const{data:x,error:p}=await j.from("favorites").select(`
          *,
          folktales (*)
        `).eq("user_id",s.id).order("created_at",{ascending:!1});if(p)throw p;o(x||[])}catch(x){console.error("Error fetching favorites:",x)}finally{l(!1)}};return t?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):s?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(L,{}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(K,{className:"h-8 w-8 text-red-500"}),e.jsx("h1",{className:"text-3xl font-bold",children:"Your Favorite Stories"})]}),e.jsx("p",{className:"text-muted-foreground",children:"Stories you've saved for later reading"})]}),n?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(A,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-muted-foreground mb-2",children:"No favorites yet"}),e.jsx("p",{className:"text-muted-foreground",children:"Start exploring stories and add them to your favorites!"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(x=>x.folktales&&e.jsx(ms,{folktale:x.folktales,isFavorited:!0,onFavoriteChange:d},x.id))})]})]}):e.jsx(Ye,{to:"/auth",replace:!0})},ae=r.forwardRef(({className:s,...t},a)=>e.jsx("textarea",{className:f("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:a,...t}));ae.displayName="Textarea";const Zt=({folktaleId:s,folktaleTitle:t})=>{const{user:a}=C(),{toast:o}=U(),[n,l]=r.useState(""),[d,x]=r.useState(""),[p,h]=r.useState(!1),[w,u]=r.useState(!0),[g,i]=r.useState(!1);r.useEffect(()=>{a&&s&&c()},[a,s]);const c=async()=>{try{const{data:m}=await j.from("user_notes").select("*").eq("user_id",a.id).eq("folktale_id",s).maybeSingle();m&&(l(m.notes||""),x(m.key_takeaways||""));const{data:T}=await j.from("reading_progress").select("*").eq("user_id",a.id).eq("folktale_id",s).maybeSingle();T&&h(T.completed)}catch(m){console.error("Error fetching user data:",m)}finally{u(!1)}},v=async()=>{if(a){i(!0);try{const{error:m}=await j.from("user_notes").upsert({user_id:a.id,folktale_id:s,notes:n.trim()||null,key_takeaways:d.trim()||null});if(m)throw m;o({title:"Notes saved",description:"Your notes have been saved successfully."})}catch(m){o({title:"Error saving notes",description:m.message,variant:"destructive"})}finally{i(!1)}}},k=async()=>{if(a)try{const{error:m}=await j.from("reading_progress").upsert({user_id:a.id,folktale_id:s,completed:!p,completed_at:p?null:new Date().toISOString()});if(m)throw m;h(!p),o({title:p?"Marked as unread":"Story completed!",description:p?"Story marked as unread.":"You've completed this story. Great job!"})}catch(m){o({title:"Error updating progress",description:m.message,variant:"destructive"})}};return w?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-32 bg-muted animate-pulse rounded-lg"}),e.jsx("div",{className:"h-32 bg-muted animate-pulse rounded-lg"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(R,{children:[e.jsx(_,{children:e.jsxs(E,{className:"flex items-center space-x-2",children:[e.jsx(A,{className:"h-5 w-5"}),e.jsx("span",{children:"Reading Progress"})]})}),e.jsx(P,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-3",children:p?e.jsxs(O,{variant:"default",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100",children:[e.jsx(X,{className:"h-3 w-3 mr-1"}),"Completed"]}):e.jsx(O,{variant:"outline",children:"In Progress"})}),e.jsxs(b,{variant:p?"outline":"default",onClick:k,className:"flex items-center space-x-2",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{children:p?"Mark as Unread":"Mark as Complete"})]})]})})]}),e.jsxs(R,{children:[e.jsx(_,{children:e.jsxs(E,{className:"flex items-center space-x-2",children:[e.jsx(st,{className:"h-5 w-5"}),e.jsx("span",{children:"My Notes"})]})}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"text-sm font-medium mb-2 block",children:"Personal Notes"}),e.jsx(ae,{id:"notes",placeholder:"Write your thoughts about this story...",value:n,onChange:m=>l(m.target.value),className:"min-h-24"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"takeaways",className:"text-sm font-medium mb-2 block",children:"Key Takeaways"}),e.jsx(ae,{id:"takeaways",placeholder:"What are the main lessons or insights from this story?",value:d,onChange:m=>x(m.target.value),className:"min-h-24"})]}),e.jsxs(b,{onClick:v,disabled:g,className:"w-full",children:[e.jsx(tt,{className:"h-4 w-4 mr-2"}),g?"Saving...":"Save Notes"]})]})]})]})},Xt=()=>{const{id:s}=ut(),{user:t}=C(),{toast:a}=U(),[o,n]=r.useState(null),[l,d]=r.useState(!1),[x,p]=r.useState(!0),[h,w]=r.useState(!1);r.useEffect(()=>{s&&(u(),t&&g())},[s,t]);const u=async()=>{try{const{data:c,error:v}=await j.from("folktales").select("*").eq("id",s).single();if(v)throw v;n(c)}catch(c){console.error("Error fetching folktale:",c)}finally{p(!1)}},g=async()=>{if(!(!t||!s))try{const{data:c,error:v}=await j.from("favorites").select("id").eq("user_id",t.id).eq("folktale_id",s).single();if(v&&v.code!=="PGRST116")throw v;d(!!c)}catch(c){console.error("Error checking favorite status:",c)}},i=async()=>{if(!t||!o){a({title:"Sign in required",description:"Please sign in to add favorites.",variant:"destructive"});return}w(!0);try{if(l){const{error:c}=await j.from("favorites").delete().eq("user_id",t.id).eq("folktale_id",o.id);if(c)throw c;d(!1),a({title:"Removed from favorites",description:"Story removed from your favorites."})}else{const{error:c}=await j.from("favorites").insert({user_id:t.id,folktale_id:o.id});if(c)throw c;d(!0),a({title:"Added to favorites",description:"Story added to your favorites."})}}catch(c){a({title:"Error",description:c.message,variant:"destructive"})}finally{w(!1)}};return x?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(L,{}),e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})]}):o?t?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(L,{}),e.jsxs("main",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsx("div",{className:"mb-6",children:e.jsx(I,{to:"/",children:e.jsxs(b,{variant:"ghost",className:"mb-4",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Back to Stories"]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-8",children:e.jsxs("article",{className:"space-y-6",children:[e.jsxs("header",{className:"text-center space-y-4",children:[e.jsx("h1",{className:"text-4xl font-bold leading-tight",children:o.title}),e.jsxs("div",{className:"flex items-center justify-center space-x-4 text-muted-foreground",children:[o.nation&&e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx(O,{variant:"outline",children:o.nation})]}),o.source&&e.jsx(O,{variant:"secondary",children:o.source})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(b,{variant:"outline",onClick:i,disabled:h,className:"flex items-center space-x-2",children:[e.jsx(K,{className:`h-4 w-4 ${l?"fill-red-500 text-red-500":"text-muted-foreground"}`}),e.jsx("span",{children:l?"Remove from Favorites":"Add to Favorites"})]})})]}),e.jsxs(R,{children:[e.jsx(_,{children:e.jsx(E,{children:"The Story"})}),e.jsx(P,{children:e.jsx("div",{className:"prose prose-lg max-w-none dark:prose-invert",children:e.jsx("p",{className:"leading-relaxed whitespace-pre-line",children:o.text})})})]})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(Zt,{folktaleId:o.id,folktaleTitle:o.title})})]})]})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(L,{}),e.jsx("div",{className:"container mx-auto px-4 py-8 max-w-md mx-auto",children:e.jsxs(R,{children:[e.jsxs(_,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(at,{className:"h-16 w-16 text-muted-foreground"})}),e.jsx(E,{children:"Sign In Required"})]}),e.jsxs(P,{className:"text-center space-y-4",children:[e.jsx("p",{className:"text-muted-foreground",children:"You need to sign in to read the full story."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{to:"/auth",className:"block",children:e.jsx(b,{className:"w-full",children:"Sign In"})}),e.jsx(I,{to:"/",className:"block",children:e.jsxs(b,{variant:"outline",className:"w-full",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Back to Stories"]})})]})]})]})})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(L,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Story not found"}),e.jsx(I,{to:"/",children:e.jsx(b,{children:"Return to Stories"})})]})]})},ea=()=>{const s=mt();return r.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",s.pathname)},[s.pathname]),e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),e.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},sa=new nt,ta=()=>e.jsx(it,{client:sa,children:e.jsx(rt,{attribute:"class",defaultTheme:"system",enableSystem:!0,children:e.jsx(Rt,{children:e.jsx(Et,{children:e.jsxs(St,{children:[e.jsx(bt,{}),e.jsx(wt,{}),e.jsx(lt,{children:e.jsxs(ft,{children:[e.jsx(q,{path:"/",element:e.jsx(Yt,{})}),e.jsx(q,{path:"/auth",element:e.jsx(Kt,{})}),e.jsx(q,{path:"/favorites",element:e.jsx(Qt,{})}),e.jsx(q,{path:"/story/:id",element:e.jsx(Xt,{})}),e.jsx(q,{path:"*",element:e.jsx(ea,{})})]})})]})})})})});xs(document.getElementById("root")).render(e.jsx(ta,{}));
